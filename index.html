<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Learn JavaScript</title>
    
    <style type="text/css">

body{background-color: #000;}

#playscape{
	position: relative;
	width: 400px;
	height: 200px;
	background-color: #020;
	-webkit-gradient(
	    linear,
	    left bottom,
	    left top,
	    color-stop(0.07, rgb(12,41,5)),
	    color-stop(0.35, rgb(29,89,14)),
	    color-stop(0.88, rgb(15,69,12)),
	    color-stop(0.6, rgb(41,97,39))
	);
	margin:0px;
	padding:0px;
}

#person{
	position: relative;
	display: block;
	width: 10px;
	height: 10px;
	background-color: #A80;
	-webkit-gradient(
	    linear,
	    left bottom,
	    left top,
	    color-stop(0.06, rgb(133,80,24)),
	    color-stop(0.6, rgb(245,106,0))
	);
	top: 50px;
	left: 50px;
}

#log{color: #fff;position: relative;}

#console{
	position: relative;
	background-color: #000;
	color: #0F0;
	width: 400px;
	height: 200px;
}

#log{
	position: relative;
	background-color: #BBA;
	width: 380px;
	height: 180px;
	color: #003;
	padding: 10px;
}

#container{
	position: relative;
	display:block;
	margin:0px auto;
	width: 400px;
	height: 800px;
	top: 0;
	left: 0;
}
    </style>
    
</head>

<body>

<div id="container">
	<div id="playscape">
		<div id="person"></div>
	</div>

	<p>
	<textarea id="console">
MAN.move('down');
MAN.move('right');
MAN.move('up');
MAN.move('pause', 1000);
MAN.move('left');
	</textarea>
	<input type="button" id="go" value="go"></input>
	</p>
	
	<p id="log"></p>
</div>	
 
 
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
    <script type="text/javascript">
        $(function()
        {
        	$("#go").bind("click", function(){
        		var code;
        		
        		code = $("#console").val();

        		$("#log").html("ran code: <pre>" + code + "</pre>");
        		
        		eval(code);
        		

        	});
        });
        
        var MAN = MAN || {};
        
        MAN.move = function(direction, duration){
			var firstMove = (MAN.movements.length === 0);
			
			//keep calculation for next move from happening until first move is done
			MAN.movements.push(function(){MAN.doMove(direction, duration)});
			
			if(firstMove){MAN.startMoving()}
        }
        MAN.movements = [];
        
        MAN.doMove = function(direction, duration){
        	var pos;
        	pos = $("#person").position();
        	
        	if(direction === "up"){
        		pos.top -= 10;
        	}else if(direction === "down"){
        		pos.top += 10;
        	}else if(direction === "left"){
        		pos.left -= 10;
        	}else if(direction === "right"){
        		pos.left += 10;
        	}else{
        		//pause;
        	}
        	
        	$("#person").animate(pos, duration, function(){
        		MAN.movements.shift();//movement is done, so pop it off of queue and call the next one...
        		MAN.startMoving();
        	});
        }
        
        MAN.startMoving = function(){
        	var movement = MAN.movements[0];
    		if(typeof movement === "function"){
    			movement();
    		}
        }
    </script>
</body>
</html>